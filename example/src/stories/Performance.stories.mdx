import { Meta } from '@storybook/addon-docs/blocks';

<Meta title="Intro/Performance" />

# Performance

Rex State makes the values returned by Hooks shareable using the React Context. However, instead of using actual context, it uses [`use-context-selector`](https://github.com/dai-shi/use-context-selector) to ensure state updates are optimized.

The idea behind `use-context-selector` is to ensure only the components that rely on a single property of the context value will re-render only when that specific value changes. Context Selectors are a [proposed feature](https://github.com/reactjs/rfcs/pull/119) of react & are not yet available within the library itself.

To take full advantage of `use-context-selector`, consider the following store:

```jsx
import { createRexStore } from 'rex-state';

const useTheme = (initialTheme = 'light') => {
  const [theme, setTheme] = useState(initialTheme);

  const toggleTheme = useCallback(
    () =>
      setTheme((currentTheme) => (currentTheme === 'light' ? 'dark' : 'light')),
    []
  );

  return { theme, toggleTheme };
};

const { useStore: useThemeStore, RexProvider: ThemeProvider } = createRexStore(
  useTheme
);
```

At any point of time, if your component only needs the `theme` property, then use the hook in the following way:

```jsx
const theme = useThemeStore((store) => store.theme);
```

This will ensure your component will only re-render if the value of theme changes & is unaffected by other properties.

Also, the `toggleTheme` function is wrapped inside `useCallback` hook because functions are non-primitive & if any of your component only needs the `toggleTheme` function, it will help prevent unnecessary re-renders. Read more about `useCallback` [here](https://reactjs.org/docs/hooks-reference.html#usecallback)
